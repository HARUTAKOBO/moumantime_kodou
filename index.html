<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>ãƒ©ã‚¤ãƒäº‰å¥ªæˆ¦ï½œãƒãƒ¼ãƒ‰é…ç½®ãƒ»å‰Šé™¤ãƒ»ãƒ«ãƒ¼ãƒˆè¨­å®š å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body{margin:0;font-family:system-ui;background:#111;color:#fff}
h1{font-size:16px;margin:8px}
.wrap{display:grid;grid-template-columns:400px 1fr;height:100vh}
.panel{background:#222;padding:12px;overflow:auto}
button,input{width:100%;margin:4px 0;padding:6px}
label{font-size:12px;color:#ccc}
canvas{background:#000;touch-action:none}
hr{border:0;border-top:1px solid #444;margin:8px 0}
.table{font-size:12px}
.table div{display:flex;justify-content:space-between}
.node-btn{background:#444}
</style>
</head>
<body>
<h1>ğŸ§­ ãƒ©ã‚¤ãƒäº‰å¥ªæˆ¦ï½œãƒãƒ¼ãƒ‰é…ç½®ãƒ»å‰Šé™¤ãƒ»ãƒ«ãƒ¼ãƒˆè¨­å®š</h1>
<div class="wrap">
<div class="panel">
<strong>ãƒãƒ¼ãƒ‰é€£ç¶šé…ç½®</strong>
<div>ç¾åœ¨ãƒ¢ãƒ¼ãƒ‰ï¼š<span id="placeMode">ãªã—</span></div>
<button onclick="setPlaceMode('start')">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
<button onclick="setPlaceMode('inn_small')">å°å®¿</button>
<button onclick="setPlaceMode('inn_big')">å¤§å®¿</button>
<button onclick="setPlaceMode('fork')">åˆ†å²</button>
<button onclick="setPlaceMode('merge')">åˆæµ</button>
<button onclick="setPlaceMode('goal')">ã‚´ãƒ¼ãƒ«</button>
<button onclick="clearPlaceMode()">é…ç½®ãƒ¢ãƒ¼ãƒ‰è§£é™¤</button>
<hr>
<strong>é¸æŠãƒãƒ¼ãƒ‰</strong>
<div id="selectedInfo">ãªã—</div>
<div id="teamChecks"></div>
<button onclick="deleteSelected()" class="node-btn">ğŸ—‘ ã“ã®ãƒãƒ¼ãƒ‰ã‚’å‰Šé™¤</button>
<hr>
<strong>è·é›¢ãƒ»æ™‚é–“çµæœ</strong>
<div id="result" class="table"></div>
</div>
<canvas id="field" width="900" height="1200"></canvas>
</div>
<script>
const canvas=document.getElementById('field');
const ctx=canvas.getContext('2d');
const bg=new Image(); bg.src='map.png';

const teams=['æ¡‚å·','å¯¿å·','æ±Ÿå·','æ¶ªå·','æ°¸å·','å…‰å·'];
const colors={æ¡‚å·:'#ff4d4d',å¯¿å·:'#4dff4d',æ±Ÿå·:'#4d4dff',æ¶ªå·:'#ffd24d',æ°¸å·:'#ff4dff',å…‰å·:'#4dffff'};

let nodes=[];
let selected=null;
let drag=null;
let placeMode=null;

function setPlaceMode(type){placeMode=type;document.getElementById('placeMode').textContent=type;}
function clearPlaceMode(){placeMode=null;document.getElementById('placeMode').textContent='ãªã—';}

function addNode(type,x,y){nodes.push({id:Date.now()+Math.random(),x,y,type,teams:[...teams]});}

function deleteSelected(){
  if(!selected) return;
  nodes = nodes.filter(n=>n!==selected);
  selected=null;
  updateSelectedPanel();
}

function updateSelectedPanel(){
  const info=document.getElementById('selectedInfo');
  const box=document.getElementById('teamChecks');
  box.innerHTML='';
  if(!selected){info.textContent='ãªã—';return;}
  info.textContent=`${selected.type}`;
  teams.forEach(t=>{
    const c=document.createElement('input');c.type='checkbox';c.checked=selected.teams.includes(t);
    c.onchange=()=>{
      if(c.checked&&!selected.teams.includes(t)) selected.teams.push(t);
      if(!c.checked) selected.teams=selected.teams.filter(x=>x!==t);
    };
    const l=document.createElement('label');l.append(c,' ',t);
    box.append(l,document.createElement('br'));
  });
}

function calcRoute(team){
  const path=nodes.filter(n=>n.teams.includes(team)).sort((a,b)=>{
    if(a.type==='start')return-1;if(b.type==='start')return 1;
    if(a.type==='goal')return 1;if(b.type==='goal')return -1;
    return b.y-a.y;
  });
  let px=0;
  for(let i=0;i<path.length-1;i++){
    px+=Math.hypot(path[i+1].x-path[i].x,path[i+1].y-path[i].y);
  }
  return px;
}

function updateResult(){
  const box=document.getElementById('result');box.innerHTML='';
  teams.forEach(t=>{
    const d=document.createElement('div');
    d.innerHTML=`<span>${t}</span><span>${calcRoute(t).toFixed(1)} px</span>`;
    box.appendChild(d);
  });
}

function draw(){
  ctx.fillStyle='#203040';ctx.fillRect(0,0,canvas.width,canvas.height);
  if(bg.complete) ctx.drawImage(bg,0,0,canvas.width,canvas.height);

  nodes.forEach(n=>{
    let c='#fff';
    if(n.type==='start')c='#0f0';if(n.type==='goal')c='#f00';
    if(n.type==='inn_small')c='#aaa';if(n.type==='inn_big')c='#ffd700';
    if(n.type==='fork')c='#0ff';if(n.type==='merge')c='#f0f';
    ctx.fillStyle=n===selected?'#0ff':c;
    ctx.beginPath();ctx.arc(n.x,n.y,8,0,Math.PI*2);ctx.fill();
  });
  updateResult();
  requestAnimationFrame(draw);
}

function getPos(e){const r=canvas.getBoundingClientRect();const t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top};}
canvas.onmousedown=e=>{
  const m=getPos(e);selected=null;
  if(placeMode){addNode(placeMode,m.x,m.y);return;}
  for(const n of nodes){if(Math.hypot(n.x-m.x,n.y-m.y)<10){selected=n;drag=n;break;}}
  updateSelectedPanel();
}
canvas.onmousemove=e=>{if(drag){const m=getPos(e);drag.x=m.x;drag.y=m.y;}}
canvas.onmouseup=()=>drag=null;

draw();
</script>
</body>
</html>

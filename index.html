<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>ãƒ©ã‚¤ãƒäº‰å¥ªæˆ¦ ãƒ«ãƒ¼ãƒˆé…ç½®ã‚¨ãƒ‡ã‚£ã‚¿</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body{margin:0;font-family:system-ui;background:#111;color:#fff}
h1{font-size:16px;margin:8px}
.wrap{display:grid;grid-template-columns:280px 1fr;height:100vh}
.panel{background:#222;padding:12px;overflow:auto}
button{width:100%;margin:4px 0;padding:6px}
label{font-size:12px;color:#ccc}
canvas{background:#000;touch-action:none}
.node{font-size:12px}
</style>
</head>
<body>
<h1>ğŸ§­ ãƒ©ã‚¤ãƒäº‰å¥ªæˆ¦ï½œãƒ«ãƒ¼ãƒˆé…ç½®ã‚¨ãƒ‡ã‚£ã‚¿ï¼ˆSTEP Aï¼‰</h1>
<div class="wrap">
<div class="panel">
<button id="addInn">â• å®¿èˆãƒãƒ¼ãƒ‰è¿½åŠ </button>
<button id="addFork">â• åˆ†å²ãƒãƒ¼ãƒ‰è¿½åŠ </button>
<button id="addGoal">â• ã‚´ãƒ¼ãƒ«ãƒãƒ¼ãƒ‰è¿½åŠ </button>
<hr>
<label>é¸æŠãƒãƒ¼ãƒ‰ï¼š<span id="sel">ãªã—</span></label>
<div id="routeChecks"></div>
<hr>
<button id="export">ğŸ“„ JSONæ›¸ãå‡ºã—</button>
<p style="font-size:12px">â€» map.png ã‚’èƒŒæ™¯ã«é…ç½®ã§ãã¾ã™</p>
</div>
<canvas id="field" width="900" height="1200"></canvas>
</div>
<script>
const canvas=document.getElementById('field');
const ctx=canvas.getContext('2d');

const bg=new Image();bg.src='map.png';

const teams=['æ¡‚å·','å¯¿å·','æ±Ÿå·','æ¶ªå·','æ°¸å·','å…‰å·'];
let nodes=[];
let selected=null;
let drag=null;

function addNode(type){
  nodes.push({id:Date.now()+Math.random(),x:450,y:600,type,teams:[...teams]});
}

function draw(){
  ctx.fillStyle='#203040';ctx.fillRect(0,0,canvas.width,canvas.height);
  if(bg.complete)ctx.drawImage(bg,0,0,canvas.width,canvas.height);
  nodes.forEach(n=>{
    ctx.fillStyle=n===selected?'#0ff':'#fff';
    ctx.beginPath();ctx.arc(n.x,n.y,10,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#000';ctx.fillText(n.type,n.x+12,n.y);
  });
  requestAnimationFrame(draw);
}

function mousePos(e){const r=canvas.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top}}
canvas.onmousedown=e=>{
  const m=mousePos(e);
  selected=null;
  for(const n of nodes){if(Math.hypot(n.x-m.x,n.y-m.y)<12){selected=n;drag=n;break}}
  updatePanel();
}
canvas.onmousemove=e=>{if(drag){const m=mousePos(e);drag.x=m.x;drag.y=m.y}}
canvas.onmouseup=()=>drag=null;

function updatePanel(){
  document.getElementById('sel').textContent=selected?selected.type:'ãªã—';
  const box=document.getElementById('routeChecks');box.innerHTML='';
  if(!selected)return;
  teams.forEach(t=>{
    const c=document.createElement('input');c.type='checkbox';c.checked=selected.teams.includes(t);
    c.onchange=()=>{
      if(c.checked&&!selected.teams.includes(t))selected.teams.push(t);
      if(!c.checked)selected.teams=selected.teams.filter(x=>x!==t);
    }
    const l=document.createElement('label');l.append(c,' ',t);
    box.append(l,document.createElement('br'));
  })
}

document.getElementById('addInn').onclick=()=>addNode('inn');
document.getElementById('addFork').onclick=()=>addNode('fork');
document.getElementById('addGoal').onclick=()=>addNode('goal');

document.getElementById('export').onclick=()=>{
  const data=JSON.stringify(nodes,null,2);
  alert(data);
}

draw();
</script>
</body>
</html>
